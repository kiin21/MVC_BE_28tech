extend ../../layouts/default.pug
include ../../mixins/filterBar
include ../../mixins/search
include ../../mixins/pagination
include ../../mixins/changeStatus
include ../../mixins/alertMessage

block main 

    +alertMessage(3000)


    link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css')
    h1 Product list 

    .card.mb-3
        .card-header Filter and search
        .card-body 
            .row 
                .col-6
                    +filterBar(filterBar)
                .col-6 
                    +search(keyword)

    .card.mb-3
        .card-header List
        .card-body 
            +form-change-multi(`${prefixAdmin}/products/changes-multi-status?_method=PATCH`)

            table(
                class='table table-hover table-sm' 
                id='check-multi'
            )
                thead
                    tr
                        th Position
                        th 
                            input(
                                type='checkbox'
                                id='check-all'
                            )
                        th Image
                        th Title
                        th Price
                        th Status 
                        th Action

                tbody#sortable
                    each product, index in products
                        tr(data-id=product._id)
                            td 
                                input(
                                    type='number'
                                    style='width: 50px;'
                                    name='position'
                                    value=product.position
                                )
                            td 
                                input(
                                    type='checkbox'
                                    class='check-item'
                                    id='check-item'
                                    value=product._id
                                )
                            td 
                                img(src=product.thumbnail alt=product.description width="100px" height="auto")
                            td #{product.title}
                            td #{product.price}$
                            td
                                if product.status === 'available'
                                    a(
                                        href='javascript:;'
                                        btn-change-status
                                        product-status=product.status
                                        product-id=product._id 
                                        class='badge bg-success'
                                    ) Available
                                else
                                    a(
                                        href='javascript:;'
                                        btn-change-status
                                        product-status=product.status
                                        product-id=product._id
                                        class='badge bg-danger'
                                    ) Unavailable
                            td
                                button(class='btn btn-warning btn-sm me-1') Edit
                                button(
                                    class='btn btn-danger btn-sm'
                                    id='btn-delete'
                                    product-id=product._id
                                ) Delete

    +pagination(paginationObj) 
    // form change multi status
    form( 
        method='POST'
        id='change-status-form'
        data-path=`${prefixAdmin}/products/change-status`
    )
    // form delete status
    form(
        method='POST'
        id='delete-form'
        data-path=`${prefixAdmin}/products/delete`
    )
    script(src='/admin/js/products.js')